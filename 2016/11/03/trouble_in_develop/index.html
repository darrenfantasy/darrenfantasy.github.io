<!DOCTYPE html>
<html lang="default">
<head>
  <meta charset="utf-8">
  
  <title>开发中遇到的坑 | darrenfantasy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="2016-11-03关于Java中Integer的值的比较今天在开发中，需要新增一个错误码的返回值，调试过程中发现
 Integer i = 40002; Integer j = 40002; i==j 返回false
 而之前错误码0的时候确实返回true Integer x = 0; Integer y = 0; x==y 返回true
 一时半会有点晕，打断点的时候才发现对象不一样。 后来">
<meta property="og:type" content="article">
<meta property="og:title" content="开发中遇到的坑">
<meta property="og:url" content="http://yoursite.com/2016/11/03/trouble_in_develop/index.html">
<meta property="og:site_name" content="darrenfantasy">
<meta property="og:description" content="2016-11-03关于Java中Integer的值的比较今天在开发中，需要新增一个错误码的返回值，调试过程中发现
 Integer i = 40002; Integer j = 40002; i==j 返回false
 而之前错误码0的时候确实返回true Integer x = 0; Integer y = 0; x==y 返回true
 一时半会有点晕，打断点的时候才发现对象不一样。 后来">
<meta property="og:updated_time" content="2017-03-11T15:06:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发中遇到的坑">
<meta name="twitter:description" content="2016-11-03关于Java中Integer的值的比较今天在开发中，需要新增一个错误码的返回值，调试过程中发现
 Integer i = 40002; Integer j = 40002; i==j 返回false
 而之前错误码0的时候确实返回true Integer x = 0; Integer y = 0; x==y 返回true
 一时半会有点晕，打断点的时候才发现对象不一样。 后来">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/typing.css">
  <link rel="stylesheet" href="/css/algolia.css">
</head>


<a href="https://github.com/darrenfantasy"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

  
    <body>
  
      <div id="container" class="container">
        <article id="post-trouble_in_develop" class="article article-type-post" itemscope itemprop="blogPost">
  <header id="header" class="header">
  <nav id="main-nav" class="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/album">Album</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
      <a href="#" class="popup-trigger">Search</a>
  </nav>
  <nav id="sub-nav">
    
  </nav>
</header>
<div class="site-search">
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>
</div>
  <hr/>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      开发中遇到的坑
    </h1>
  

      </header>
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <hr>
<h2 id="2016-11-03关于Java中Integer的值的比较"><a href="#2016-11-03关于Java中Integer的值的比较" class="headerlink" title="2016-11-03关于Java中Integer的值的比较"></a>2016-11-03关于Java中Integer的值的比较</h2><p>今天在开发中，需要新增一个错误码的返回值，调试过程中发现</p>
<p> Integer i = 40002;<br> Integer j = 40002;<br> i==j 返回false</p>
<p> 而之前错误码0的时候确实返回true<br> Integer x = 0;<br> Integer y = 0;<br> x==y 返回true</p>
<p> 一时半会有点晕，打断点的时候才发现对象不一样。<br> 后来查资料发现</p>
<p><pre><code><br> public static Integer valueOf(int i) {<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">return</span>  i &gt;= <span class="number">128</span> || i &lt; -<span class="number">128</span> ? <span class="keyword">new</span> Integer(i) : SMALL_VALUES[i + <span class="number">128</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * A cache of instances used by &#123;<span class="doctag">@link</span> Integer#valueOf(int)&#125; and auto-boxing</div><div class="line"> */</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer[] SMALL_VALUES = <span class="keyword">new</span> Integer[<span class="number">256</span>];</div><div class="line"></div><div class="line"><span class="keyword">static</span> &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = -<span class="number">128</span>; i &lt; <span class="number">128</span>; i++) &#123;</div><div class="line">        SMALL_VALUES[i + <span class="number">128</span>] = <span class="keyword">new</span> Integer(i);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></code></pre></p>
<p> <br> 默认Integer值在－127到128区间内，就会把i作为变量存到内存里。否则会new一个Integer对象。<br> 所以比较Integer值的时候，可以使用Integer.intValue()或者直接用equals()比较。</p>
<hr>
<h2 id="2017-01-12开发表情搜搜demo时遇到的一些问题"><a href="#2017-01-12开发表情搜搜demo时遇到的一些问题" class="headerlink" title="2017-01-12开发表情搜搜demo时遇到的一些问题"></a>2017-01-12开发表情搜搜demo时遇到的一些问题</h2><p>大约一周半的时间，完成了表情搜搜demo<br>以下记录了开发中遇到的问题</p>
<p>1.Intent无法传递太大数据<br>（业务需求：把后打开的页面里的一个图片的base64传到上一个页面，由于数据量过大，后改为把图片的url传回上个页面再去转成base64）<br>因为遇到要在后打开的页面传递值返回到上一个页面，所以用StartActivityForResult方法。在setResult时通过Intent来把图片的base64传回去，<br>但是遇到错误信息：E/JavaBinder﹕ !!! FAILED BINDER TRANSACTION !!!<br>查阅资料发现  <a href="https://developer.android.com/reference/android/os/TransactionTooLargeException.html" target="_blank" rel="external">https://developer.android.com/reference/android/os/TransactionTooLargeException.html</a><br>The Binder transaction buffer has a limited fixed size, currently 1Mb, which is shared by all transactions in progress for the process. Consequently this exception can be thrown when there are many transactions in progress even when most of the individual transactions are of moderate size.<br>Binder事务缓冲区具有有限的固定大小，目前为1Mb，由进程正在进行的所有事务共享。因此，当有许多事务正在进行时，即使大多数单独的事务大小适中，也可以抛出此异常.</p>
<p>2.SharedPreferences存StringSet时，不能直接操作取出的set.否则数据会丢失<br>(业务需求：缓存本地搜索记录，因为是要存10个字符串，所以一开始想简单点直接用StringSet，后来因为set无序，所以改用拼接字符串)<br>查源代码发现  *</p><p>Note that you <em>must not</em> modify the set instance returned</p>
<pre><code>* by this call.  The consistency of the stored data is not guaranteed
* if you do, nor is your ability to modify the instance at all.
</code></pre><p>3.Android 防止点击事件穿透（在布局的根节点添加Android:clickable=”true” 属性即可，用来获取焦点防止点击事件穿透）</p>
<p>4.自定义view为内部类时，没有将内部类设置为static<br>导致java.lang.NoSuchMethodException: <init> [class android.content.Context, interface android.util.AttributeSet]</init></p>
<p>5.想监听一个父布局的ontouch事件时，发现用手触摸时只打印出Action.move和up.如果点击父布局里的子控件时，什么事件都无法打印出来。<br>回想了下之前View的事件分发机制，不能在重写OnTouchEvent方法里监听到事件，因为onTouch事件优先与OnTouchEvent执行，如果onTouch返回true将事件消费了,则onTouchEvent将不会执行。<br>详见 （ <a href="http://darrenfantasy.com/2016/11/08/android_event_dispatch/" target="_blank" rel="external">Android事件分发机制</a>）</p>

      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/2016/11/03/trouble_in_develop/" class="article-date">
  <time datetime="2016-11-03T08:00:58.000Z" itemprop="datePublished">2016-11-03</time>
</a>

        </li>
        
        
          <li>
            <span class="label">Tag:</span>
            
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>


          </li>
        
        <hr/>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <a href="/2016/11/08/android_event_dispatch/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Android事件分发机制
        
      </div>
    </a>
  
  
    <a href="/2016/10/25/git_command_line/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">git常用命令行</div>
    </a>
  
</nav>


  
</article>


  <section id="comments" class="comments">
  <div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2128029"></script>
  </section>



      </div>
      
    <footer id="footer" class="post-footer footer">
      <hr/>
      <div id="footerContent" class="footer-content">
        <p>stay hungry , stay foolish .</p>


  
    <span id="busuanzi_container_page_pv">
         <i class="fa fa-flag"></i>    你是第<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>个阅读本文的小伙伴
    </span>
  
      </div>
  </footer>

      

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


  <script src="http://cdn.bootcss.com/instantsearch.js/1.5.1/instantsearch.js"></script>
  <script src="/js/algolia.js"></script>

<script src="/js/typing.js"></script>
<!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->







<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
      <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
    </div>
  </body>
</html>
